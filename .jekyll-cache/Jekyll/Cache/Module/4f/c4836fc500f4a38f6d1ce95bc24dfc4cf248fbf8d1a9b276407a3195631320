I"ùL





<article id="post-alexa-alexa-skill-net-core" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        Alexa Skill con .Net Core & AWS Lambda
      
    </h1>

    <div class="post-date">
      <span>
        
          
          <time datetime="2020-06-22T00:00:00-05:00">22 Jun 2020</time>
        
        
        
        
        
        









in <a href="/alexa/" class="flip-title">Alexa</a>

        









on <span>Alexa</span>

      </span>
      
        
          
          
          
            
            <span class="ellipsis ml1" title="Last modified at">
              <span class="sr-only">Last modified at:</span>
              <span class="icon-history"></span>
              
              <time datetime="2022-04-27T12:53:57-05:00">2022-04-27</time>
            </span>
          
        
      
    </div>
    
    
      
        <div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">
          


<img
  
    src="/assets/img/blog/post-headers/alexa-skill-net-core-header.png"
  
  alt="Alexa Skill con .Net Core & AWS Lambda"
  
  
  width="864"
  height="486"
  loading="lazy"
/>

        </div>
      
      
    

    



  
    <p class="note-sm" >
      Tutorial de c√≥mo desarrollar una Alexa Skill con .NET Core y AWS Lambda desde Visual Studio

    </p>
  


  </header>

  
    <p>Las Skills de Alexa se pueden desarrollar utilizando las Lambda Functions de AWS o usando un servidor REST.Lambda Function es la implementaci√≥n de Amazon de funciones serverless disponibles en AWS.Amazon recomienda usar las Lambda functions a pesar de que no sean f√°ciles de debuggear.Si bien puedes loggear en CloudWatch, no puedes poner un breakpoint y revisor el c√≥digo.</p>

<p>Esto hace que debuggear una request que nos env√≠a Alexa sea un completo desaf√≠o.Este post explica una soluci√≥n simple pero √∫til: levantar un proyecto Web API para debug local y un proyecto de funci√≥n Lambda para luego poder desplegar en AWS.Ambos proyectos ejecutar√°n el mismo c√≥digo escrito en C#.</p>

<h1 id="requisitos">Requisitos</h1>

<p>Entonces, ya sabemos que las aplicaciones para Alexa se llaman habilidades, en esta ocasi√≥n vamos a construir una skill muy sencilla que le pida al usuario que adivine un n√∫mero aleatorio entre 1 y 10. Para seguir, necesitaremos:</p>

<ul>
  <li>.NET Core 2.1 SDK</li>
  <li>Una cuenta de desarrollador de Amazon (requerida para Alexa Development).</li>
  <li>Una cuenta de Amazon Web Services (nos mantendremos dentro del uso de nivel gratuito)</li>
  <li>Visual Studio 2019 (se puede hacer esto con Visual Studio Code, pero sus pasos diferir√°n un poco)</li>
</ul>

<h1 id="alexa-developer-console">Alexa Developer Console</h1>

<p>Una vez que contemos con la cuenta de desarrollador de Amazon, deberemos de dirigirnos a la consola de desarrollador de Alexa. Posteriromente deberemos de crear una nueva skill, as√≠gnarle un nombre (Number Game).</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step01.png" alt="image" /></p>

<p>Desp√∫es seleccionar ‚ÄòHabilidad Personalizada‚Äô (Custom), puesto que no queremos un modelo prefabricado para este proyecto.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step02.png" alt="image" /></p>

<p>Y para los recursos de back-end de la habilidad, seleccione ‚ÄòAprovisione el Suyo‚Äô (Provision your own), ya que vamos a crear un Lambda Function y se lo atribuiremos a nuestra habilidad.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step03.png" alt="image" /></p>

<p>Posteriormente deberemos seleccionar una plantilla, para nuestro ejemplo, elijamos la primera opcion: Start from scratch</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step04.png" alt="image" /></p>

<p>Una vez que creamos la Skill, deber√≠amos ver el panel de desarrollo principal. No estaremos escribiendo c√≥digo en esta consola, pero crearemos el modelo de interacci√≥n para nuestra Alexa Skill. Este modelo define las instrucciones de voz que permiten a los usuarios conversar con la Skill.</p>

<p>Vamos a seguir la lista de verificaci√≥n en el lado derecho de la consola para desarrollar nuestra Skill. El primer paso es configurar un nombre de invocaci√≥n. Esta es la frase que hablar√° un usuario para iniciar nuestra aplicaci√≥n; por ejemplo, ‚ÄúAlexa, abre curiosidades de Mexico‚Äù. Los usuarios tambi√©n pueden combinar el nombre de invocaci√≥n con un comando, como ‚ÄúAlexa, dime un dato curioso de m√©xico‚Äù para obtener la informaci√≥n.</p>

<p>Invocation Name: number games</p>

<p>En este ejemplo, usaremos ‚ÄúAlexa, open number games‚Äù.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step05.png" alt="image" /></p>

<p>Para definir la interfaz de voz para nuestra skill, deberemos asignarle una entrada hablada a las intenciones de nuestros controladores de servicio que se procesan de fondo. En nuestro juego de ejemplo, queremos proporcionar un comando para que el usuario inicie un nuevo juego. Entonces el usuario puede decir ‚Äúnuevo juego‚Äù, ‚Äújugar un juego‚Äù, ‚Äúiniciar un juego‚Äù o muchas otras variaciones de esto.</p>

<p>Cada una de esas frases se llama uterrances. Independientemente de la redacci√≥n exacta, es importante saber que se desea activar la misma funcionalidad. Entonces dereremos generar una intenci√≥n y asociar todas las expresiones de muestra que deseamos que active esta intenci√≥n.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step06.png" alt="image" /></p>

<p>En el panel de control de Alexa Developer, hacemos clic en el elemento dos de la lista de verificaci√≥n y generaremos una intenci√≥n personalizada. N√≥mbremoslo NewGameIntent y luego agregue los enunciados de muestra (invente los suyos o use los del p√°rrafo anterior). Esta es una intenci√≥n muy b√°sica porque no permitimos ninguna variable en la respuesta del usuario; tiene que coincidir exactamente con uno de nuestros enunciados.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step07.png" alt="image" /></p>

<p>Luego, deberemos de crear otro Intent, llamado ‚ÄúAnswerIntent‚Äù, esta manejara el intento del usuario de adivinar el n√∫mero.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step08.png" alt="image" /></p>

<p>En este caso, lo que queremos es que usuario pueda brindar diversas opciones, por ende al igual que el Intent previo, deberemos de agregar algunas expresiones de muestra para manejar la entrada del usuario; Esto como vimos anteriormente se logra f√°cilmente, pero ¬øc√≥mo manejamos el n√∫mero de conjeturas? Para esto existen los Slots: esta es una palabra o frase que representa informaci√≥n variable. Por ejemplo, un nombre, una ubicaci√≥n geogr√°fica, una fecha o, en nuestro caso, un n√∫mero.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step09.png" alt="image" /></p>

<p>Un enunciado con un slot utiliza llaves: ‚Äú¬øEs {n√∫mero}?‚Äù - El espacio ‚Äún√∫mero‚Äù, debe estar definido, por lo que utilizamos AMAZON.NUMBER como nuestro tipo de Slots</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step10.png" alt="image" /></p>

<p>Cuando hayamos terminado, seleccionemos ‚ÄúConstruir Modelo‚Äù para aplicar todos los cambios que hayamos realizado a la versi√≥n de desarrollo de nuestra Skill.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step11.png" alt="image" /> - <img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step12.png" alt="image" /> - <img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step13.png" alt="image" /></p>

<p>Adem√°s, si nos desplazamos hacia abajo m√°s all√° de la seccion de Intents y Slots, en el men√∫ del lado izquierdo de la Consola, veremos la opcion de Editor JSON. Si hacemos clic, veremos el JSON que representa la interfaz de usuario de voz que hayamos definido (desde elnombre de invocaci√≥n, los Intents, Utterances y Slots, etc).</p>

<h1 id="visual-studio-2019">Visual Studio 2019</h1>

<p>Ahora que hemos creado el modelo para manejar a un usuario que habla con Alexa, nos toca escribir el c√≥digo del back-end de nuestra Skill.</p>

<p>Cabe recordar que puede ser una API escrita en cualquier idioma y alojada en cualquier lugar, pero Amazon recomienda Lambda (la versi√≥n AWS de Function as a Service). En resumen, Lambda nos permite ejecutar c√≥digo sin preocuparnos por servidores u otra infraestructura (computaci√≥n sin servidor). Otra raz√≥n para usar Lambda es que para muchos casos de uso, es pr√°cticamente gratis (hasta para 1 mill√≥n de solicitudes por mes).</p>

<p>Una excelente manera de compilar e implementar funciones de Lambda es usar Visual Studio 2019 junto con AWS ToolKit for Visual Studio. Entonces para esto debimos de haber instalado el kit de herramientas de AWS,  para posteriormente iniciar Visual Studio y crear un nuevo proyecto de AWS Lambda en .NET Core (puede ser con pruebas o sin ellas, en esta ocasion  no cubrir√© las pruebas unitarias)</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step14.png" alt="image" /></p>

<h1 id="alexanet">Alexa.NET</h1>

<p><a href="https://www.timheuer.com/blog">Tim Heuer</a> cre√≥ un paquete incre√≠ble llamado Alexa.NET que envuelve muchas de las funciones de Alexa en una sola biblioteca de C# .Net Core.</p>

<p>Entonces para nuestro ejemplo, abramos el administrador de dependencias NuGet del Proyecto, busquemos e instalemos este paquete.Yo instale la version versi√≥n 1.13.2.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step15.png" alt="image" /></p>

<h2 id="qu√©-es-alexanet">¬øQu√© es Alexa.NET?</h2>

<p>Es una librer√≠a auxiliar para trabajar con requests/responses de Skills de Alexa en C#. El objetivo de esta librer√≠a es que el trabajar con la API de Alexa sea m√°s natural para un desarrollador de C# que utiliza un modelo de objetos fuertemente tipado.</p>

<p>Podemos encontrar toda la documentaci√≥n en su repositorio GitHub oficial: <a href="https://github.com/timheuer/alexa-skills-dotnet">https://github.com/timheuer/alexa-skills-dotnet</a></p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step16.png" alt="image" /></p>

<h1 id="functionscs">Functions.cs</h1>

<p>Si le echamos un vistazo al archivo Function.cs, encontraremos el punto de entrada para nuestra funci√≥n Lambda. La plantilla que Visual Studio crea para nosotros incluye una funci√≥n muy simple, y si deseamos practicar, podemos publicarla en Lambda y luego probarla.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step17.png" alt="image" /></p>

<p>Pero nos mantendremos enfocados en Alexa y reemplazaremos todo el c√≥digo de este archivo con el fragmento a continuaci√≥n: <a href="https://gist.github.com/LucioMSP/090b49385d2cbeef6cf4e00bbdd4c0df#file-function-cs-v2">https://gist.github.com/LucioMSP</a></p>

<script src="https://gist.github.com/LucioMSP/090b49385d2cbeef6cf4e00bbdd4c0df.js"></script>

<p>Como ya lo mencionamos anteriormente, este c√≥digo es una simple Alexa Skill que le pide al usuario que adivine un n√∫mero entre uno y diez.</p>

<p>FunctionHandler es nuestro punto de entrada; toma entrada en forma de una solicitud de habilidad y devuelve una SkillResponse.</p>

<p>Si se trata de una solicitud de lanzamiento, un usuario acaba de activar nuestra habilidad diciendo el nombre de invocaci√≥n. Si hemos recibido una IntentRequest (l√≠nea 39), Alexa ha comparado el comando del usuario con un enunciado de muestra y su intenci√≥n asociada. En ese caso, activamos el nombre de la intenci√≥n y activamos nuestra funcionalidad deseada.</p>

<p>Independientemente del tipo de solicitud que recibamos, creamos nuestra respuesta utilizando m√©todos est√°ticos de la clase ResponseBuilder. Nuestra respuesta consta de algunas partes, la pieza m√°s obvia es la respuesta de texto que queremos que Alexa hable con nuestro usuario. Tambi√©n tenemos que determinar si mantener abierta la sesi√≥n actual o finalizarla. En la mayor√≠a de los casos, desear√° que su habilidad contin√∫e atrayendo al usuario solicitando m√°s informaci√≥n o explorando otra parte de la habilidad. Use ResponseBuilder.Ask () para mantener la sesi√≥n abierta y esperar otra respuesta del usuario. ResponseBuilder.Tell () dir√° la respuesta y luego finalizar√° inmediatamente la sesi√≥n (cerrando efectivamente su aplicaci√≥n).</p>

<p>ResponseBuilder.Ask () tambi√©n requiere que pase un objeto Reprompt; Esta es solo una cadena que Alexa hablar√° si el usuario no responde a su mensaje original. Si su respuesta original fue interminable (‚Äúel juego termin√≥, lo complet√≥ en siete intentos, esa es una nueva puntuaci√≥n alta, ¬øquiere volver a jugar?‚Äù), Tener un Reprompt corto (como ‚Äú¬øjugar de nuevo?‚Äù O ‚Äú¬øQu√© sigue?‚Äù A menudo es mejor que repetir el mensaje original.</p>

<p>Mientras un usuario avanza y retrocede con su habilidad a trav√©s de Alexa, querr√° realizar un seguimiento de d√≥nde se encuentra en la conversaci√≥n. Ah√≠ es donde entra en juego el objeto Sesi√≥n. Desde el momento en que alguien lanza su habilidad hasta que la habilidad se termina (al decir ‚Äúdetener‚Äù u otra frase que desencadena un final), el objeto de sesi√≥n conservar√° los datos que su habilidad puede referenciar mientras maneja los intentos. Sin embargo, cada vez que un usuario inicia su habilidad, se crea una nueva sesi√≥n. Si desea almacenar datos entre sesiones, deber√° utilizar un almac√©n de datos m√°s persistente como DynamoDB.</p>

<p>Los atributos de sesi√≥n se almacenan en un diccionario al que puede hacer referencia a trav√©s de SkillRequest.Session.Attributes; puede leer y escribir en este objeto (consulte las l√≠neas 54 y 69). Un caso de uso de muestra es cuando le hace al usuario una pregunta de s√≠ o no, y su respuesta es manejada por un YesIntent o NoIntent gen√©rico. Tendr√°s que recordar qu√© fue lo que preguntaste o la conversaci√≥n no ir√° a ning√∫n lado. En nuestro c√≥digo de muestra, almacenamos la cantidad de conjeturas y la respuesta que buscamos utilizando los atributos de la sesi√≥n, y modificamos nuestra respuesta en funci√≥n de si la conjetura del usuario coincide con nuestro n√∫mero m√°gico.</p>
<h1 id="publish-to-aws-lambda">Publish to AWS Lambda</h1>

<p>Ahora necesitamos llevar nuestro c√≥digo a la nube. Para este paso, deberemos de contar con nuestras credenciales de AWS configuradas en la m√°quina local; Visual Studio puede recogerlos autom√°ticamente si ya se configur√≥ un usuario a trav√©s de la CLI de AWS. De lo contrario, deberemos de hacer esto en otro momento, ya que no lo veremos a continuacion.</p>

<p>En Visual Studio, hacemos clic con el bot√≥n derecho en el proyecto en el Explorador de soluciones y seleccionamos Publicar en AWS Lambda.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step18.png" alt="image" /></p>

<p>Aseg√∫remosnos de seleccionar el perfil deseado y la regi√≥n de AWS, despues solo completemos el nombre de la funci√≥n tal como deseamos que aparezca en AWS Lambda.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step19.png" alt="image" /></p>

<p>Damos en Continuar o Next.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step20.png" alt="image" /></p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step21.png" alt="image" /></p>

<p>Despu√©s de hacer clic en Cargar, si todo va bien, podemos ir al panel de Lambda en la consola de administraci√≥n de AWS y ver nuestra nueva funci√≥n</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step22.png" alt="image" /></p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step23.png" alt="image" /></p>

<h1 id="desencadenador">Desencadenador</h1>

<p>Una vez en la funci√∂n, y para permitir que Alexa invoque la funci√≥n Lambda, deberemos agregar un desencadenador a la configuraci√≥n de esta misma.</p>

<p>Entonces en la vista del dise√±ador de la funci√≥n, hacemos clic en el bot√≥n ‚ÄúA√±adir desencadenador‚Äù</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step24.png" alt="image" /></p>

<p>Y elegimos el kit de habilidades de Alexa (Alexa Skills Kit) como desencadenador.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step25.png" alt="image" /></p>

<p>Amazon recomienda habilitar la verificaci√≥n de ID de habilidad, para garantizar que solo su habilidad espec√≠fica (o habilidades, puede agregar m√°s de un disparador del Kit de habilidades de Alexa) pueda invocar su funci√≥n Lambda. Puede encontrar el ID de su habilidad en la p√°gina principal de la Consola de desarrollador de Alexa. (View Skill ID)</p>

<h1 id="prueba-end-to-end">Prueba End to End</h1>

<p>Nuestro √∫ltimo paso de configuraci√≥n es conectar la Alexa Skill al EndPoint (punto final) Lambda. Seleccionemos ‚ÄùEndPoint‚Äù en el men√∫ de la izquierda en el panel de Alexa y modifiquemos el ARN de AWS Lambda para que la regi√≥n predeterminada apunte a nuestro Lambda. Encontraremos el ARN de nuestra Lambda en la esquina superior derecha de la pantalla cuando veamos nuestra funci√≥n en el panel de AWS.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step26.png" alt="image" /></p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step27.png" alt="image" /></p>

<p>Ahora finalmente podemos probar esto. Para realizarlo, vayamos a la consola de Alexa, aunque tambi√©n podemos probar en un dispositivo, siempre que el dispositivo est√© utilizando la misma cuenta de Amazon que su cuenta de desarrollador de Alexa. Hagamos clic en la pesta√±a ‚ÄúPrueba‚Äù (Test) cerca de la parte superior de la pantalla. Posteriormente escribamos (o hablemos) el comando de invocaci√≥n para lanzar nuestra skill (‚Äùopen number games‚Äù). Esperemos a que la Skill responda, y luego podremos ver la solicitud y respuesta JSON. Posteriormente podemos continuar conversando con nuestra Skill para probar cualquier cantidad de escenarios.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step28.png" alt="image" /></p>

<p>Y bueno, eso es todo, ya tenemos una habilidad funcional de Alexa creada desde Visual Studio.</p>

<h1 id="alexa-skill--errores">Alexa Skill == Errores</h1>

<p>Si nuestra Skill no se comporta como esperamos, o si vemos que ‚Äúhubo un problema con la respuesta de la Skill solicitada‚Äù, deberemos profundizar en los registros producidos por la funci√≥n Lambda para rastrear el error.</p>

<p><img src="/assets/img/blog/tutorials/alexa-skill-net-core/Step29.png" alt="image" /></p>

<p>Para encontrar los registros de cualquier habilidad, deberemos de navegar a Cloudwatch en la consola de administraci√≥n de AWS. Seleccionar ‚ÄúGrupos de Registro‚Äù en el men√∫ de navegaci√≥n de la izquierda, y aqui deberiamos ver una entrada con el nombre de la funci√≥n Lambda. Despues deberemos hacer clic en esa entrada y ver una lista de secuencias de registro, ordenadas por las modificaciones m√°s recientes.</p>

<p>Por ultimo deberemos a√±adir un registro adicional a la funci√≥n para rastrear errores u obtener informaci√≥n sobre c√≥mo se comporta su aplicaci√≥n.</p>

<hr />

<p>Si estas interesado en saber m√°s sobre el desarrollo de Alexa Skills, puedes unirte a la comunidad de desarrolladores de voz en M√©xico, comunidad que lleva por nombre <a href="https://www.facebook.com/groups/voxAlexaSkills">vox: Ninja Alexa</a>.</p>

<p>Recuerda adem√°s que si tienes alguna inquietud o pregunta, no dudes en ponerte en contacto conmigo o poner un comentario a continuaci√≥n.</p>

  
</article>
:ET